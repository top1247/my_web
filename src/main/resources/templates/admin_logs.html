<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ“ä½œæ—¥å¿—</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .result-badge { padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; }
        .result-success { background: #f0f9ff; color: #0369a1; }
        .result-failed { background: #fef2f2; color: #b91c1c; }
        .filter-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="top-navbar">
        <div class="logo">
            <div class="logo-icon">â˜</div>
            <span>é˜¿é‡Œäº‘æˆæœ¬ç®¡ç†ç³»ç»Ÿ</span>
        </div>
        <div class="user-info">
            <span class="username" th:text="${username}"></span><span th:if="${user_type == 'admin'}" style="color:#67c23a">[ç®¡ç†å‘˜]</span>
            <a th:href="@{/logout}" class="logout-link">é€€å‡ºç™»å½•</a>
        </div>
    </div>

    <div class="sidebar">
        <ul class="sidebar-menu">
            <li><a th:href="@{/}"><i>ğŸ </i> é¦–é¡µ</a></li>
            <li><a th:href="@{/aliyun/keys}"><i>ğŸ”‘</i> å¯†é’¥ç®¡ç†</a></li>
            <li><a th:href="@{/aliyun/bills}"><i>ğŸ“Š</i> è´¦å•ç®¡ç†</a></li>
            <li style="margin-top: 20px; padding: 8px 24px; color: #999; font-size: 12px;">ç®¡ç†å‘˜åŠŸèƒ½</li>
            <li><a th:href="@{/admin/users}"><i>ğŸ‘¥</i> ç”¨æˆ·ç®¡ç†</a></li>
            <li><a th:href="@{/admin/logs}" class="active"><i>ğŸ“</i> æ“ä½œæ—¥å¿—</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div class="page-header">
            <h1 class="page-title">æ“ä½œæ—¥å¿—</h1>
            <p class="page-subtitle">ç³»ç»Ÿæ“ä½œå®¡è®¡å’Œè¿½è¸ªè®°å½•ï¼ˆæœ€è¿‘500æ¡ï¼‰</p>
        </div>

        <div class="content-card">
            <h2 class="card-title">ç­›é€‰æ¡ä»¶</h2>
            <form method="GET" th:action="@{/admin/logs}" class="filter-form">
                <div class="form-group">
                    <label for="operationType">æ“ä½œç±»å‹</label>
                    <select id="operationType" name="operationType">
                        <option value="">å…¨éƒ¨ç±»å‹</option>
                        <option th:each="opType : ${operationTypes}" th:value="${opType}" th:text="${opType}"></option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="keyword">å…³é”®è¯</label>
                    <input type="text" id="keyword" name="keyword" placeholder="ç”¨æˆ·åæˆ–æ“ä½œæè¿°">
                </div>
                <div class="form-group" style="display: flex; align-items: flex-end; gap: 8px;">
                    <button type="submit" class="btn">ğŸ” æŸ¥è¯¢</button>
                    <button type="button" class="btn-danger" th:onclick="'location.href=\'' + @{/admin/logs} + '\''">é‡ç½®</button>
                </div>
            </form>
        </div>

        <div class="content-card">
            <h2 class="card-title">æ—¥å¿—åˆ—è¡¨ï¼ˆå…± <span th:text="${#lists.size(logs)}"></span> æ¡ï¼‰</h2>
            <div th:if="${not #lists.isEmpty(logs)}">
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 8%">ID</th>
                                <th style="width: 12%">æ“ä½œç”¨æˆ·</th>
                                <th style="width: 12%">æ“ä½œç±»å‹</th>
                                <th style="width: 30%">æ“ä½œæè¿°</th>
                                <th style="width: 10%">ç»“æœ</th>
                                <th style="width: 13%">IPåœ°å€</th>
                                <th style="width: 15%">æ“ä½œæ—¶é—´</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="log : ${logs}">
                                <td th:text="${log.id}"></td>
                                <td><strong th:text="${log.username}"></strong></td>
                                <td><span style="background: #f3f4f6; padding: 4px 8px; border-radius: 4px; font-size: 12px;" th:text="${log.operationType}"></span></td>
                                <td th:text="${log.operationDesc}"></td>
                                <td>
                                    <span class="result-badge" th:classappend="${log.result == 'success'} ? 'result-success' : 'result-failed'">
                                        <span th:if="${log.result == 'success'}">âœ“ æˆåŠŸ</span>
                                        <span th:if="${log.result != 'success'}">âœ— å¤±è´¥</span>
                                    </span>
                                </td>
                                <td style="font-size: 12px; color: #999;" th:text="${log.ipAddress != null ? log.ipAddress : '-'}"></td>
                                <td style="font-size: 12px; color: #999;" th:text="${log.createdAt != null ? log.createdAt.toString().replace('T', ' ').substring(0, 19) : '-'}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div th:if="${#lists.isEmpty(logs)}" style="text-align: center; padding: 60px 0; color: #999;">
                <div style="font-size: 64px; margin-bottom: 16px;">ğŸ“</div>
                <p style="font-size: 16px;">æš‚æ— æ—¥å¿—è®°å½•</p>
            </div>
        </div>
    </div>
</body>
</html>
